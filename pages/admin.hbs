<div class="d-flex align-items-start">
  <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
    <button onclick="inp_tb2()" class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">xlsx</button>
    <button onclick="inp_tb()" class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false">input</button>
    <button onclick="inp_tb1()" class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" data-bs-target="#v-pills-messages" type="button" role="tab" aria-controls="v-pills-messages" aria-selected="false">download xlsx</button>
    <button onclick="pokypka()" class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">Pokypka</button>
  </div>
  <div class="tab-content" id="v-pills-tabContent">
    <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
        <h2 id='sel_tab2'>select table</h2>
        {{!-- <form action="/admin/xlsx" enctype="multipart/form-data" method="POST">
            <div class="input-group mb-3">
                <button class="btn btn-outline-secondary" type="submit" id="inputGroupFileAddon03">Button</button>
                <input type="file"  name="xlsx1" class="form-control" id="inputGroupFile03" aria-describedby="inputGroupFileAddon03" aria-label="Upload">
            </div>
        </form> --}}
    </div>
    <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
        <h2 id='sel_tab'>select table</h2>
    </div>
    <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
        <h2 id='sel_tab1'>select table</h2>
    </div>
    <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">

    </div>
  </div>
</div>
<script>

let main_obj = {
    input1:function(x){
        let json_data = JSON.parse(x)
        let select = '<select id="insel_tab" class="form-select form-select-sm" aria-label=".form-select-sm example">'
        for(let i = 0;i<json_data.length;i++){
            select+= '<option value="'+json_data[i].table_name+'">'+json_data[i].table_name+'</option>';
        }
        select+='</select><button type="button" onclick="select_bttn()" class="btn btn-primary" style="margin-top: 1rem;margin-bottom: 3rem;">Select</button>';
        let inn = document.getElementById('v-pills-profile');
        inn.innerHTML = "<h2 id='sel_tab'>select table</h2>";
        let sel_tab = document.getElementById('sel_tab');
        sel_tab.insertAdjacentHTML('afterend', select);
    },
    input2:function(x,y){
        let json_tabs = JSON.parse(x);
        let form = '<form method="POST" id="forma_vidpr" tb_name="'+y+'">';
        for(let i = 0;i<json_tabs.length;i++){
            form+=`<div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">`+json_tabs[i].column_name+`</span>
                    <input type="text" class="form-control" name="`+json_tabs[i].column_name+`" aria-describedby="basic-addon1">
                   </div>`
        }
        form+='<button type="button" onclick="insert_bttn()" class="btn btn-primary" style="margin-top: 1rem;">Input</button></form>';
        console.log(form)
        let vstavka = document.getElementById('v-pills-profile');
        vstavka.insertAdjacentHTML('beforeend', form);
    },
    input3:function(x){
        let json_tabs = JSON.parse(x);
        //console.log(json_tabs);
        let select = '<select id="insel_tab1" class="form-select form-select-sm" aria-label=".form-select-sm example">'
        for(let i = 0;i<json_tabs.length;i++){
            select+= '<option value="'+json_tabs[i].table_name+'">'+json_tabs[i].table_name+'</option>';
        }
        select+='</select><button type="button" onclick="select_bttn1()" class="btn btn-primary" style="margin-top: 1rem;margin-bottom: 3rem;">Select</button>';
        let vstavka = document.getElementById('v-pills-home');
        vstavka.insertAdjacentHTML('beforeend', select);
    },
    xlsx_input:function(x){
        let json_data = JSON.parse(x);
        let select = '<select id="insel_tab1" class="form-select form-select-sm" aria-label=".form-select-sm example">'
        for(let i = 0;i<json_data.length;i++){
            select+= '<option value="'+json_data[i].table_name+'">'+json_data[i].table_name+'</option>';
        }
        select+='</select><button type="button" onclick="xlsx_bttn()" id="xlsx_bttn" class="btn btn-primary" style="margin-top: 1rem;margin-bottom: 3rem;">Select</button>';
        let inn = document.getElementById('v-pills-messages');
        inn.innerHTML = "<h2 id='sel_tab1'>select table</h2>";
        let sel_tab1 = document.getElementById('sel_tab1');
        sel_tab1.insertAdjacentHTML('afterend', select);
        console.log(select)
    },
    check_list:function(x,y){
        let tabs = JSON.parse(x);
        let list = '<form id="list" tb_name="'+y+'">';
        for(let i = 0;i<tabs.length;i++){
            list+= `<input type="text" class="form-control" placeholder='`+tabs[i].column_name+`' name="`+tabs[i].column_name+`" aria-describedby="basic-addon1">`;
        }
        list+='<button type="button" onclick="check_()" class="btn btn-primary" style="margin-top: 1rem;">Input</button></form>';
        let vstavka = document.getElementById('v-pills-home');
        vstavka.insertAdjacentHTML('beforeend', list);
    }
}

function insert_bttn(){
    let forma = document.getElementById('forma_vidpr');
    let table_name = forma.getAttribute('tb_name');
    console.log('tb_name ', table_name)
    let data = new Map()
    data.set("table",table_name);
    console.log('---------------')
    for(let i = 0;i<forma.childNodes.length-1;i++){
        data.set(forma.childNodes[i].childNodes[1].innerHTML,forma.childNodes[i].childNodes[3].value);
    }
    let obj = Object.fromEntries(data);
    data = JSON.stringify(obj);
    let request2 = new XMLHttpRequest();
    request2.open("POST", "/admin/insert", true);   
    request2.setRequestHeader("Content-Type", "application/json");
    request2.addEventListener("load", function () {
        console.log(request2.responseText)
    });
    request2.send(data);
}

function select_bttn(){
    let select_form = document.getElementById('insel_tab');
    let request1 = new XMLHttpRequest();
    let data1 =JSON.stringify({
        "content" : select_form.value
    });
    request1.open("POST", "/admin/polyatabl", true);   
    request1.setRequestHeader("Content-Type", "application/json");
    request1.addEventListener("load", function () {
        main_obj.input2(request1.response,select_form.value);
    });
    request1.send(data1);
}

function select_bttn1(){
    let select_form = document.getElementById('insel_tab1');
    let request1 = new XMLHttpRequest();
    let data1 =JSON.stringify({
        "content" : select_form.value
    });
    request1.open("POST", "/admin/polyatabl", true);   
    request1.setRequestHeader("Content-Type", "application/json");
    request1.addEventListener("load", function () {
        main_obj.check_list(request1.response,select_form.value);
    });
    request1.send(data1);
}

function xlsx_bttn(){
    console.log('xlsx bttn')
    let bttn = document.getElementById('v-pills-messages');
        console.log(bttn.outerHTML)
        bttn.insertAdjacentHTML("beforeend","<br><a onclick='del_xlsx()' href='/public/table.xlsx' >Скачати файл</a>")
    let xlsx_value = document.getElementById('insel_tab1');
    let data = JSON.stringify({
        "content" : xlsx_value.value
    })
    let request = new XMLHttpRequest();
    request.open("POST", "/admin/jsontoxlsx", true);   
    request.setRequestHeader("Content-Type", "application/json");
    request.addEventListener("load", function () {
        console.log(request.responseText);
    });
    request.send(data);
}

function del_xlsx(){
    console.log('locationnnn')
    let request = new XMLHttpRequest();
    let data='';
    request.open("POST", "/admin/delxlsx", true);   
    request.setRequestHeader("Content-Type", "application/json");
    request.addEventListener("load", function () {
        console.log(request.responseText);
    });
    request.send(data);
}

function inp_tb(){
    let request = new XMLHttpRequest();
    let data =JSON.stringify({
        "content" : "*"
    });
    request.open("POST", "/admin/tabs", true);   
    request.setRequestHeader("Content-Type", "application/json");
    request.addEventListener("load", function () {
        main_obj.input1(request.response);
    });
    request.send(data);
}
function inp_tb1(){
    let request = new XMLHttpRequest();
    let data =JSON.stringify({
        "content" : "*"
    });
    request.open("POST", "/admin/tabs", true);   
    request.setRequestHeader("Content-Type", "application/json");
    request.addEventListener("load", function () {
        main_obj.xlsx_input(request.response);
    });
    request.send(data);
}
function inp_tb2(){
    let request = new XMLHttpRequest();
    let data =JSON.stringify({
        "content" : "*"
    });
    request.open("POST", "/admin/tabs", true);   
    request.setRequestHeader("Content-Type", "application/json");
    request.addEventListener("load", function () {
        main_obj.input3(request.response);
    });
    request.send(data);
}
function check_(){
    let list = document.getElementById('list');
    let tb_name = list.getAttribute('tb_name')
    let spysok = {};
    for(let i=0;i<list.childNodes.length-1;i++){
        //console.log(list.childNodes[i].placeholder,list.childNodes[i].value);
        spysok[list.childNodes[i].value] = list.childNodes[i].placeholder;
    }
    spysok["table"] = tb_name;
    //spysok = JSON.stringify(spysok)
    let list_html=`<form action="/admin/xlsx" enctype="multipart/form-data" method="POST">
            <div class="input-group mb-3">
                <button class="btn btn-outline-secondary" type="submit" id="inputGroupFileAddon03">Button</button>
                <input type="file"  name="xlsx1" class="form-control" id="inputGroupFile03" aria-describedby="inputGroupFileAddon03" aria-label="Upload">
                <input type="hidden" id='spysok' name="spysok">
            </div>
        </form>`
    
    let vstavka = document.getElementById('v-pills-home');
    vstavka.insertAdjacentHTML('beforeend', list_html);
    let spys = document.getElementById('spysok');
    spys.value = JSON.stringify(spysok);
}

function pokypka(){
    let pok_list = new XMLHttpRequest();
    pok_list.open("POST", "/admin/customer_pokypka", true);   
    pok_list.setRequestHeader("Content-Type", "application/json");
    pok_list.addEventListener("load", function () {
        let tabinner = document.getElementById('v-pills-settings');
        let data = pok_list.responseText;
        tabinner.innerHTML += '<select id="select_user" class="form-select form-select-sm" aria-label=".form-select-sm example"><option value="all">All</select>';
        let select_user = document.getElementById('select_user');
        data = JSON.parse(data);
        for(let elem of data){
            select_user.innerHTML+='<option value="'+elem.login+'">'+elem.name+" "+elem.username+'</option>';
        }
        tabinner.insertAdjacentHTML('beforeend','<button class="btn btn-primary" style="margin-top: 1rem;" onclick="select_user()">Вибрати</button>')
    });
    pok_list.send();
}
function select_user(){
    let data_form = document.getElementById('select_user');
    let data = JSON.stringify({
        'username' : data_form.value
    })
    console.log(data)
    let select_user = new XMLHttpRequest();
    select_user.open("POST", "/admin/select_user", true);   
    select_user.setRequestHeader("Content-Type", "application/json");
    select_user.addEventListener("load", function () {
        console.log(select_user.responseText)
        let tabinner = document.getElementById('v-pills-settings');
        let stroka = '<table id="table_inf" class="table"><thead><tr>';
        //let table_inf = document.getElementById(table_inf);
        let inform = JSON.parse(select_user.responseText)
        for(let keys in inform[0]){
            stroka+= '<th scope="col">'+keys+'</th>';
        }
        stroka += '</thead><tbody>'
        for(let elem of inform){
            stroka+='<tr>';
            stroka+=`<th scope="row">`+elem.id_pokypku+`</th>
                    <td>`+elem.products+`</td>
                    <td>`+elem.client_id+`</td>
                    <td>`+elem.adress+`</td>
                    <td>`+elem.date+`</td>`
            stroka+='</tr>';
        }
        stroka+='</tbody></table>'
        console.log(tabinner.childNodes.length)
        if(tabinner.childNodes.length<=3){
            tabinner.insertAdjacentHTML('beforeend', stroka);
        }else{
            let table_node = document.getElementById('table_inf');
            table_node.remove();
            tabinner.insertAdjacentHTML('beforeend', stroka);
        }
    });
    select_user.send(data)
}

</script>





    